<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCA x TAGs é¢¨å‘³è©•é‘‘ç³»çµ± v2.0</title>
    <!-- å¼•å…¥å¿…è¦çš„åº« -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* åŸºç¤æ¨£å¼ */
        body { font-family: "Helvetica Neue", Arial, sans-serif; background: #f4f4f4; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 600px; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { color: #2c3e50; text-align: center; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        
        /* è¡¨å–®æ¨£å¼ */
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #34495e; }
        input[type="text"], input[type="email"], select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        
        /* è©•åˆ†æ»‘æ¡¿å€ */
        .score-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; background: #f9f9f9; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .score-item label { font-size: 14px; display: flex; justify-content: space-between; }
        .score-val { color: #e67e22; font-weight: bold; }
        input[type="range"] { width: 100%; }

        /* æŒ‰éˆ• */
        .btn-submit { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-submit:hover { background: #219150; }
        .btn-submit:disabled { background: #ccc; cursor: wait; }

        /* --- B2C å¡ç‰‡æ¨£å¼ (éš±è—ç”Ÿæˆå€) --- */
        /* ä½¿ç”¨ absolute positioning ç§»å‡ºè¦–çª—å¤–ï¼Œä½†ä¿æŒæ¸²æŸ“ç‹€æ…‹ä¾› html2canvas æˆªåœ– */
        #b2c-render-area { 
            position: absolute; left: -9999px; top: 0; 
            width: 400px; height: 500px; /* 4:5 æ¯”ä¾‹ */
            background: #fff;
            font-family: 'Microsoft JhengHei', sans-serif;
            border: 1px solid #ddd; /* æˆªåœ–æ™‚ä¸æœƒæœ‰é‚Šæ¡†ï¼Œå› ç‚ºæˆ‘å€‘æœƒæˆªå…§å®¹ */
        }
        
        /* B2C å¡ç‰‡è¨­è¨ˆ (Poster Style) */
        .b2c-card {
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #ffffff 0%, #f3f3f3 100%);
            display: flex; flex-direction: column;
            padding: 25px; box-sizing: border-box;
            position: relative;
            color: #333;
        }
        .b2c-header { text-align: center; margin-bottom: 10px; }
        .b2c-product { font-size: 24px; font-weight: 900; color: #000; letter-spacing: 1px; margin-bottom: 5px; border-bottom: 3px solid #000; display: inline-block; padding-bottom: 5px; }
        .b2c-tags { font-size: 14px; color: #e67e22; font-weight: bold; margin-top: 5px; }
        
        .b2c-chart-container { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; }
        
        .b2c-footer { text-align: center; font-size: 12px; color: #888; margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px; }
        .b2c-slogan { font-weight: bold; color: #2c3e50; font-size: 14px; margin-bottom: 3px; }

        .status-msg { text-align: center; margin-top: 10px; color: #e74c3c; font-weight: bold; display: none; }
    </style>
</head>
<body>

    <!-- 1. è¼¸å…¥ä»‹é¢ (SCA å°ˆæ¥­ç‰ˆ) -->
    <div class="container" id="pro-form-area">
        <h1>â˜• SCA x TAGs å°ˆæ¥­è©•é‘‘</h1>
        
        <div class="form-group">
            <label>è©•é‘‘è€… (Evaluator)</label>
            <input type="text" id="evaluator" placeholder="æ‚¨çš„å§“å">
        </div>
        <div class="form-group">
            <label>Email (æ¥æ”¶å ±å‘Šç”¨)</label>
            <input type="email" id="email" placeholder="name@example.com">
        </div>
        <div class="form-group">
            <label>æ¨£å“åç¨± (Product Name)</label>
            <input type="text" id="productName" value="ç‰¹é¸ç´…çƒé¾ (æ‰¹è™Ÿ2025-A)">
        </div>

        <!-- 6 è»¸è©•åˆ† (1.0 - 5.0) -->
        <label>SCA è©•åˆ† (1.0 - 5.0)</label>
        <div class="score-grid">
            <div class="score-item">
                <label>Aroma (ä¹¾/æ¿•é¦™) <span class="score-val" id="val-aroma">3.0</span></label>
                <input type="range" id="aroma" min="1" max="5" step="0.1" value="3.0" oninput="updateVal(this)">
            </div>
            <div class="score-item">
                <label>Flavor (é¢¨å‘³) <span class="score-val" id="val-flavor">3.0</span></label>
                <input type="range" id="flavor" min="1" max="5" step="0.1" value="3.0" oninput="updateVal(this)">
            </div>
            <div class="score-item">
                <label>Aftertaste (é¤˜éŸ») <span class="score-val" id="val-aftertaste">3.0</span></label>
                <input type="range" id="aftertaste" min="1" max="5" step="0.1" value="3.0" oninput="updateVal(this)">
            </div>
            <div class="score-item">
                <label>Acidity (é…¸è³ª) <span class="score-val" id="val-acidity">3.0</span></label>
                <input type="range" id="acidity" min="1" max="5" step="0.1" value="3.0" oninput="updateVal(this)">
            </div>
            <div class="score-item">
                <label>Body (é†‡åšåº¦) <span class="score-val" id="val-body">3.0</span></label>
                <input type="range" id="body" min="1" max="5" step="0.1" value="3.0" oninput="updateVal(this)">
            </div>
            <div class="score-item">
                <label>Balance (å¹³è¡¡) <span class="score-val" id="val-balance">3.0</span></label>
                <input type="range" id="balance" min="1" max="5" step="0.1" value="3.0" oninput="updateVal(this)">
            </div>
            <!-- Structure åœ¨åŸ SCA è¡¨ä¸­é€šå¸¸æ•´åˆåœ¨ Flavor æˆ– Bodyï¼Œé€™è£¡ç‚ºäº†é…åˆ B2C å…¬å¼ï¼Œæˆ‘å€‘å¢åŠ ä¸€å€‹éš±è—åƒæ•¸æˆ–è®“ç”¨æˆ¶è¼¸å…¥ï¼Œå‡è¨­ç‚ºäº†æ¼”ç¤ºï¼Œæˆ‘å€‘å¢åŠ  Structure æ¬„ä½ -->
             <div class="score-item" style="grid-column: 1 / -1; border-top:1px dashed #ccc; padding-top:10px;">
                <label>Structure (çµæ§‹æ„Ÿ - ä¾›B2Cé‹ç®—ç”¨) <span class="score-val" id="val-structure">3.0</span></label>
                <input type="range" id="structure" min="1" max="5" step="0.1" value="3.0" oninput="updateVal(this)">
            </div>
            <div class="score-item" style="grid-column: 1 / -1;">
                <label>Sweetness (ç”œåº¦ - ä¾›B2Cé‹ç®—ç”¨) <span class="score-val" id="val-sweetness">3.0</span></label>
                <input type="range" id="sweetness" min="1" max="5" step="0.1" value="3.0" oninput="updateVal(this)">
            </div>
        </div>

        <div class="form-group">
            <label>é¢¨å‘³è¯æƒ³ (TAGs) - è«‹ç”¨é€—è™Ÿåˆ†éš”ï¼Œç³»çµ±å°‡æŠ“å–å‰ 3 å€‹</label>
            <input type="text" id="tags" value="ğŸ¯ èœ‚èœœ, ğŸ ç†Ÿæœ, ğŸªµ æªœæœ¨, ğŸŒ¼ é‡è–‘èŠ±" placeholder="ä¾‹å¦‚: èŠ±é¦™, èœ‚èœœ, å …æœ">
        </div>

        <button class="btn-submit" id="btnSubmit" onclick="processEvaluation()">ğŸ“¤ ä¸Šå‚³è³‡æ–™ä¸¦å¯„é€é›™ç‰ˆæœ¬åœ–å¡</button>
        <div id="statusMsg" class="status-msg"></div>
    </div>

    <!-- 2. B2C å¡ç‰‡ç”Ÿæˆå€ (éš±è—) -->
    <div id="b2c-render-area">
        <div class="b2c-card" id="b2cCard">
            <div class="b2c-header">
                <div class="b2c-product" id="b2c-name-display">PRODUCT NAME</div>
                <div class="b2c-tags" id="b2c-tags-display">TAG 1 | TAG 2 | TAG 3</div>
            </div>
            <div class="b2c-chart-container">
                <canvas id="b2cChart"></canvas>
            </div>
            <div class="b2c-footer">
                <div class="b2c-slogan">æ•¸æ“šåŒ–å‘ˆç¾ï¼Œé¢¨å‘³çœ‹å¾—è¦‹</div>
                <div>Powered by SCA x TAGs System</div>
            </div>
        </div>
    </div>

<script>
    const GOOGLE_SCRIPT_URL = "æ‚¨çš„_GOOGLE_SCRIPT_URL"; // âš ï¸ è«‹å¡«å…¥å¾Œç«¯ç¶²å€

    function updateVal(input) {
        document.getElementById('val-' + input.id).innerText = input.value;
    }

    async function processEvaluation() {
        const btn = document.getElementById('btnSubmit');
        const msg = document.getElementById('statusMsg');
        
        // 0. åŸºç¤é©—è­‰
        const email = document.getElementById('email').value;
        const name = document.getElementById('productName').value;
        if(!email || !name) { alert("è«‹å¡«å¯« Email èˆ‡ å“å"); return; }

        btn.disabled = true;
        btn.innerText = "ğŸ”„ æ­£åœ¨é€²è¡Œ B2C è½‰è­¯é‹ç®—...";
        msg.style.display = 'block';
        msg.innerText = "1. è®€å–å°ˆæ¥­æ•¸æ“š...";

        // 1. å–å¾—åŸå§‹åˆ†æ•¸
        const scores = {
            aroma: parseFloat(document.getElementById('aroma').value),
            flavor: parseFloat(document.getElementById('flavor').value),
            aftertaste: parseFloat(document.getElementById('aftertaste').value),
            acidity: parseFloat(document.getElementById('acidity').value),
            body: parseFloat(document.getElementById('body').value),
            balance: parseFloat(document.getElementById('balance').value),
            structure: parseFloat(document.getElementById('structure').value),
            sweetness: parseFloat(document.getElementById('sweetness').value)
        };

        // 2. åŸ·è¡Œ B2C è½‰è­¯é‚è¼¯ (Translation Logic)
        msg.innerText = "2. ç”Ÿæˆ B2C é¢¨å‘³è­˜åˆ¥å¡...";
        const b2cData = calculateB2C(scores);
        renderB2CView(name, document.getElementById('tags').value, b2cData);

        // ç­‰å¾… Chart.js æ¸²æŸ“å‹•ç•«å®Œæˆ (çµ¦äºˆç·©è¡)
        await new Promise(r => setTimeout(r, 500));

        // 3. æˆªåœ– - å°ˆæ¥­ç‰ˆ (Pro)
        msg.innerText = "3. æˆªå–å°ˆæ¥­è©•é‘‘è¡¨...";
        const proCanvas = await html2canvas(document.getElementById('pro-form-area'), {
            scale: 2, backgroundColor: "#ffffff"
        });
        const imgPro = proCanvas.toDataURL("image/png");

        // 4. æˆªåœ– - é›¶å”®ç‰ˆ (B2C)
        msg.innerText = "4. æˆªå–é›¶å”®é¢¨å‘³å¡...";
        const b2cCanvas = await html2canvas(document.getElementById('b2c-render-area'), {
            scale: 2, backgroundColor: "#ffffff" // å¼·åˆ¶ç™½åº•
        });
        const imgB2C = b2cCanvas.toDataURL("image/png");

        // 5. å‚³é€è‡³å¾Œç«¯
        msg.innerText = "5. è³‡æ–™ä¸Šå‚³é›²ç«¯...";
        
        const payload = {
            evaluator: document.getElementById('evaluator').value,
            email: email,
            productName: name,
            scores: scores,
            tags: document.getElementById('tags').value,
            imagePro: imgPro,
            imageB2C: imgB2C
        };

        fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "text/plain" },
            body: JSON.stringify(payload)
        })
        .then(() => {
            msg.style.color = "#27ae60";
            msg.innerText = "âœ… è©•é‘‘å®Œæˆï¼é›™ç‰ˆæœ¬åœ–å¡å·²å¯„å‡ºã€‚";
            btn.innerText = "å®Œæˆ";
            // ä¸æ¢å¾©æŒ‰éˆ•ï¼Œé¿å…é‡è¤‡æäº¤
        })
        .catch(err => {
            console.error(err);
            msg.innerText = "âŒ å‚³é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– Script";
            btn.disabled = false;
        });
    }

    // --- B2C æ ¸å¿ƒé‚è¼¯ ---
    function calculateB2C(s) {
        // å…¬å¼é©—è­‰ï¼š
        // Weight = Body*0.8 + Structure*0.2
        // Brightness = Acidity*1.0
        // Length = Sweetness*0.7 + Structure*0.3
        // Complexity = Aroma*0.6 + Balance*0.4
        
        const round = (num) => Math.round(num * 10) / 10;

        return {
            weight: round(s.body * 0.8 + s.structure * 0.2),
            brightness: round(s.acidity * 1.0),
            length: round(s.sweetness * 0.7 + s.structure * 0.3),
            complexity: round(s.aroma * 0.6 + s.balance * 0.4)
        };
    }

    let b2cChartInstance = null;

    function renderB2CView(name, tagsRaw, data) {
        // 1. è¨­å®šæ–‡å­—
        document.getElementById('b2c-name-display').innerText = name;
        
        // 2. è™•ç† Tags (å–å‰ä¸‰)
        let tagsArr = tagsRaw.split(/[,ï¼Œ]/).map(t => t.trim()).filter(t => t !== "");
        let displayTags = tagsArr.slice(0, 3).join(" ï½œ ");
        document.getElementById('b2c-tags-display').innerText = displayTags || "ç²¾é¸é¢¨å‘³";

        // 3. ç¹ªè£½é›·é”åœ–
        const ctx = document.getElementById('b2cChart').getContext('2d');
        
        if (b2cChartInstance) b2cChartInstance.destroy(); // æ¸…é™¤èˆŠåœ–

        b2cChartInstance = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: [
                    `é‡é‡æ„Ÿ ${data.weight}`, 
                    `æ˜äº®åº¦ ${data.brightness}`, 
                    `é¤˜éŸ» ${data.length}`, 
                    `å±¤æ¬¡æ„Ÿ ${data.complexity}`
                ],
                datasets: [{
                    label: 'Flavor Profile',
                    data: [data.weight, data.brightness, data.length, data.complexity],
                    backgroundColor: 'rgba(230, 126, 34, 0.5)', // æ©˜è‰²åŠé€æ˜
                    borderColor: 'rgba(230, 126, 34, 1)',
                    borderWidth: 3,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#d35400',
                    pointRadius: 5
                }]
            },
            options: {
                scales: {
                    r: {
                        angleLines: { color: '#eee' },
                        grid: { color: '#eee' },
                        pointLabels: {
                            font: { size: 16, weight: 'bold', family: 'Microsoft JhengHei' },
                            color: '#2c3e50'
                        },
                        suggestedMin: 0,
                        suggestedMax: 5,
                        ticks: { display: false, stepSize: 1 } // éš±è—åˆ»åº¦æ•¸å­—ï¼Œä¿æŒç°¡æ½”
                    }
                },
                plugins: {
                    legend: { display: false } // éš±è—åœ–ä¾‹
                },
                animation: false // é—œé–‰å‹•ç•«ä»¥åˆ©æˆªåœ–
            }
        });
    }
</script>

</body>
</html>
